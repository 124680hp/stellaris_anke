<!DOCTYPE html>
<html><head><style>body {
   color: black;
}
</style>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>个人安科-网站分享</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/localforage/1.10.0/localforage.min.js"></script>
</head>
<link rel="stylesheet" href="../css/index.css" />
<link rel="stylesheet" href="../css/article.css" />
<link rel="stylesheet" href="../css/table.css" />

<body>
<div class="container">
	<div class="header">
		<div class="dropdown">
		<a href="../index.html">
			<button class="dropbtn">首页</button>
		</a>
		<div class="dropdown-content">
			<a href="../index.html">前往首页</a>
		</div>
	</div>
	<div class="dropdown">
		<a href="../background/index.html">
			<button class="dropbtn">背景描述</button>
		</a>
		<div class="dropdown-content">
			<a href="../background/index.html">背景描述</a>
			<a href="#">测试1</a>
		</div>
	</div>
	<div class="dropdown">
		<a href="../detail/index.html">
			<button class="dropbtn">现有数据</button>
		</a>
		<div class="dropdown-content">
			<a href="../detail/index.html">现有数据</a>
			<a href="../detail/character.html">角色模板</a>
			<a href="../detail/character_form.html">新建角色</a>
			<a href="../detail/character_list.html">角色列表</a>
			<a href="../detail/race.html">种族模板</a>
			<a href="../detail/race_form.html">新建种族</a>
			<a href="../detail/race_list.html">种族列表</a>
			<a href="../detail/item.html">道具模板</a>
			<a href="../detail/item_form.html">新建道具</a>
			<a href="../detail/item_list.html">道具列表</a>
			<a href="../detail/skill.html">技能模板</a>
			<a href="../detail/skill_form.html">新建技能</a>
			<a href="../detail/skill_list.html">技能列表</a>
			<a href="../detail/bonus.html">杂项</a>
		</div>
	</div>
	<div class="dropdown">
		<a href="../story/index.html">
			<button class="dropbtn">安科内容</button>
		</a>
		<div class="dropdown-content">
			<a href="../story/index.html">安科内容</a>
		</div>
	</div>
	<div class="dropdown">
		<a href="./index.html">
			<button class="dropbtn">网站分享</button>
		</a>
		<div class="dropdown-content">
			<a href="./index.html">网站分享</a>
		</div>
	</div>
	</div>

	<div class="content">
	<div class="article">
		<h2>本网页将展现已经出现在我的安科文本中的角色数据（静态形式）以及您创建的角色数据（动态形式）</h2>
		<p>以下为已经出现在安科中的角色</p>
		<table>
			<tbody>
            <tr>
				<td>角色名：马祺福</td>
				<td>别名：迪斯马</td>
            </tr>
			<tr>
				<td>所属种族：新派奥伦人</td>
				<td>生日：未知，现在15岁</td>
            </tr>
			<tr>
				<td>来自：派奥伦</td>
				<td>性别：男性</td>
            </tr>
            <tr>
				<td colspan="2">属性值————力量82，意志71，体质62，智力29，感知104，魅力54，口才23，灵敏50</td>
			</tr>
			<tr>
				<td colspan="2">擅长属性————暂无</td>
			</tr>
			<tr>
				<td>生命值上限：310</td>
				<td>精神值上限：355</td>
            </tr>
            <tr>
				<td colspan="2">天生拥有技能以及被动（仅名字）————切开血管，邪恶切割，决斗突刺，追踪射击，抵近射击，手枪射击，霰弹轰扫，阅读情绪，进食需求，荒野求生知识</td>
            </tr>
			<tr>
				<td colspan="2">持有物品————新石器时代部落制石刀</td>
            </tr>
            <tr>
				<td colspan="2">
					具体描述：不止为何来到派奥伦的乱入角色，现在15岁（大概），不止为何变成了这个种族的人，是派奥伦星球后石器部落时代的主角
				</td>
            </tr>
			</tbody>
		</table>
		<p>以下略</p>
		
		<p>以下为您新建的角色</p>
		<div id="tablesContainer">
			<!-- 动态生成的表格将会放在这里 -->
		</div>
		
		<p>如果想要删除某项数据，请复制对应的自动编码至以下文本框中（表单会在刷新后消失）</p>
		<form action="" method="" id="delete">
			<div>
				<p>请输入需要删除的数据的自动编码</p>
				<input type="text" value="" id="uuid" required name="uuid" />
			</div>
			<div id="submit">
				<input type="submit" value="提交" />
			</div>
		<form>
		<p>以下为清空本地存储的按钮，请谨慎操作</p>
		<button id="clearStorageButton">清空存储</button>
	</div>
	</div>
	
</div>
<script>
document.addEventListener('DOMContentLoaded', function() {
    var tablesContainer = document.getElementById('tablesContainer');

    // 清空现有的表格容器内容
    tablesContainer.innerHTML = '';

    localforage.iterate(function(value, key) {
        // 每次迭代都会执行此回调
		if (value && value.f_type === "character"){
			// 当value存在，并且value.f_type等于"character"时，才继续创建表
			
			// 创建一个新的表格已经表格体
			var table = document.createElement('table');
			var tbody = document.createElement('tbody');

			//  读取表单中的数据
			var name = value.name;
            var alias = value.alias;
            var race = value.race;
			var birth = value.birth;
            var sex = value.sex;
            var strength = +value.strength;
            var wisdom = +value.wisdom;
            var constitution = +value.constitution;
            var intelligence = +value.intelligence;
            var sense = +value.sense;
            var charisma = +value.charisma;
            var eloquence = +value.eloquence;
            var dexterity = +value.dexterity;
            var expert = value.expert;
			var origin = value.origin;
			var skills = value.skills;
			var items = value.items;
			var detail = value.detail;
			
			var tr_1 = document.createElement('tr');
			var td_name = document.createElement('td');
			var td_alias = document.createElement('td');
			
			td_name.textContent = '角色名：' + name;
			td_alias.textContent = '别名：' + alias;
			
			tr_1.appendChild(td_name);
			tr_1.appendChild(td_alias);
			tbody.appendChild(tr_1);
			
			var tr_2 = document.createElement('tr');
			var td_race = document.createElement('td');
			var td_birth = document.createElement('td');
			
			td_race.textContent = '所属种族：' + race;
			td_birth.textContent = '生日：' + birth;
			
			tr_2.appendChild(td_race);
			tr_2.appendChild(td_birth);
			tbody.appendChild(tr_2);
			
			var tr_3 = document.createElement('tr');
			var td_origin = document.createElement('td');
			var td_sex = document.createElement('td');
			
			td_origin.textContent = '来自：' + origin;
			td_sex.textContent = '性别：' + sex;
			
			tr_3.appendChild(td_origin);
			tr_3.appendChild(td_sex);
			tbody.appendChild(tr_3);
			
			var tr_4 = document.createElement('tr');
			var td_ability = document.createElement('td');
			td_ability.setAttribute('colspan', '2');
			
			td_ability.textContent = '属性值————力量' + strength + '，意志' + wisdom + '，体质' + constitution + '，智力' + intelligence + '，感知' + sense + '，魅力' + charisma + '，口才' + eloquence + '，灵敏' + dexterity;
			
			tr_4.appendChild(td_ability);
			tbody.appendChild(tr_4);
			
			var tr_5 = document.createElement('tr');
			var td_expert = document.createElement('td');
			td_expert.setAttribute('colspan', '2');
			
			td_expert.textContent = expert.length > 0 ? expert.join(", ") : "暂无";
			td_expert.textContent = '擅长属性————' + td_expert.textContent;
			
			tr_5.appendChild(td_expert);
			tbody.appendChild(tr_5);
			
			var tr_6 = document.createElement('tr');
			var td_hp = document.createElement('td');
			var td_san = document.createElement('td');
			
			td_hp.textContent = '生命值上限：' + constitution * 5;
			td_san.textContent = '精神值上限：' + wisdom * 5;
			
			tr_6.appendChild(td_hp);
			tr_6.appendChild(td_san);
			tbody.appendChild(tr_6);
			
			var tr_7 = document.createElement('tr');
			var td_skills = document.createElement('td');
			td_skills.setAttribute('colspan', '2');
			
			td_skills.textContent = '天生拥有技能以及被动（仅名字）————' + skills;
			
			tr_7.appendChild(td_skills);
			tbody.appendChild(tr_7);
			
			var tr_8 = document.createElement('tr');
			var td_items = document.createElement('td');
			td_items.setAttribute('colspan', '2');
			
			td_items.textContent = '持有物品————' + items;
			
			tr_8.appendChild(td_items);
			tbody.appendChild(tr_8);
			
			var tr_9 = document.createElement('tr');
			var td_detail = document.createElement('td');
			td_detail.setAttribute('colspan', '2');
			
			td_detail.textContent = '具体描述：' + detail;
			
			tr_9.appendChild(td_detail);
			tbody.appendChild(tr_9);
                
        
			// 将表格体添加到表格中
			table.appendChild(tbody);
			// 为表格添加一个标题
			var caption = table.createCaption();
			caption.textContent = '自动编码为: ' + key + '的角色数据为————';

			// 将表格添加到容器中
			tablesContainer.appendChild(table);
		}else{
			// 如果value不存在或value.f_type不是"character"，则跳过（可能存在其它项目也使用了localforage，提前规避）
			console.log('跳过非角色类型数据或未定义f_type的项');
		}
    }).then(function() {
        console.log('数据已经全部读取');
    }).catch(function(err) {
        // 发生错误时
        console.error('迭代数据时出错:', err);
    });
});
</script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    var clearBtn = document.getElementById('clearStorageButton');

    clearBtn.addEventListener('click', function() {
        // 确认操作
        if(confirm("确定要清空所有本地存储的数据吗？这个操作是不可逆的。")) {
            localforage.clear().then(function() {
                // 数据已被清除
                alert('本地存储的数据已经成功清空。');
            }).catch(function(err) {
                // 发生错误
                console.error('清空存储时出错:', err);
                alert('清空存储失败。');
            });
        }
    });
});
</script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    var form = document.getElementById('delete');

    form.addEventListener('submit', function(event) {
        event.preventDefault(); // 防止表单的默认提交行为

        var uuid = document.getElementById('uuid').value; // 获取用户输入的 UUID

        if (!uuid) {
            alert("请输入数据的自动编码。");
            return;
        }

        // 调用 localForage 的 removeItem 方法来删除对应的数据
        localforage.removeItem(uuid).then(function() {
            console.log('数据删除成功');
            alert('数据删除成功');
            // 可能还想清除输入框的内容
            document.getElementById('uuid').value = '';
        }).catch(function(err) {
            console.error('数据删除失败', err);
            alert('数据删除失败');
        });
    });
});
</script>
</body></html>